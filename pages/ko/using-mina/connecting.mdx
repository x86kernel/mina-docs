import Page from "@reason/pages/Docs";
import StatusBadge from "@reason/components/StatusBadge";
import DocLink from "@reason/components/DocLink";
export default Page({ title: "Connect to the Network" });

# 네트워크에 연결하기

이 섹션에서는, `매인넷` 네트워크에 접속해서 우리의 첫 트랜젝션을 날려볼 것입니다. 먼저, 명령을 실행하기 위해 노드를 실행해보겠습니다.

## 소프트웨어 업데이트

`메인넷` 에 접속하기 위한 첫번째 과정은 최신 버전의 데몬을 설치하는 것입니다. 아래 과정을 따라 사용하고있는 운영체제에 맞는 방법을 참고하시기 바랍니다.

### Ubuntu 18.04 / Debian 9

첫번째로, 사용하고 있던 이전 버전의 데몬을 제거해서 최신버전으로 업데이트중 에러가 나는것을 방지해야 합니다. 그리고, 다음을 따라해서 최신 버전을 설치할 수 있습니다.

```
sudo apt-get remove -y mina-testnet-postake-medium-curves
echo "deb [trusted=yes] http://packages.o1test.net release main" | sudo tee /etc/apt/sources.list.d/mina.list
sudo apt-get update
sudo apt-get install -y curl unzip mina-mainnet=1.1.5-a42bdee
```

데몬이 올바르게 설치됐는지 확인하려면, `mina version` 명령어를 실행해보면 알 수 있습니다. 해당 명령어의 출력은 `Commit a42bdeef6b0c15ee34616e4df76c882b0c5c7c2a on branch master` 이여야 합니다.

## 노드 시작하기

이 기술이 아직 비교적 새롭기 때문에 노드를 실행할때 문제가 발생하는 몇가지 상황이 있습니다. 우리는 당신의 노드가 올바르지 않게 되고, 이것을 깨닫지 못하는 것을 원하지 않습니다! 그래서 공식적으로 지원되는 몇 가지 자동 재시작 과정을 만들었습니다. 향후 릴리즈에서 이를 반복할 것입니다.

그러나, 먼저 자동 재시작 과정을 시작하기 전에 수동으로 실행하여 모든것이 제대로 작동하는지 확인해야합니다.

참고: Hetzner 호스팅 제공 업체를 사용하는 경우, Hetzner 에서 미나 소프트웨어가 악의적이라고 판단하는 문제가 발생하고 있습니다. 노드를 시작하기 전에 이를 해결하는 방법을 알아보려면, 문제 해결 페이지에서 네트워킹 섹션을 참조하세요.

아래의 명령어를 실행하여 미나 노드를 실행하고 네트워크에 연결할수 있습니다.

```
mina daemon --generate-genesis-proof true --peer-list-url https://storage.googleapis.com/mina-seed-lists/mainnet_seeds.txt
```

지분이 있는 키를 가지고 블록을 생산하고자 하면, `-block-producer-key ~/keys/my-wallet` 인자를 덧붙혀야 합니다. `~/keys-my-wallet` 의 경우 기본과 다를 경우, 개인키가 위치한 경로로 대체하시기 바랍니다.

위에서 덧붙힌 `-peer-list` 인자는 시드 피어 주소를 지정합니다. 이것은 네트워크에서 연결할 초기 피어입니다. 미나는 P2P 프로토콜이므로 우리가 의존하는 단일 중앙 집중식 서버가 없습니다.

노드를 처음 실행할 때 일반적으로 발생하는 문제는 <DocLink copy="여기" url="/troubleshooting" /> 를 참조하시기 바랍니다.

아직 끝나지 않았습니다! 이제 독립 실행형 프로세스를 실행하여 문제가 없는지 확인했으므로, 미나가 죽을때 자동으로 다시 시작되는 방식으로 미나를 시작하는 것이 중요합니다.

먼저, 실행중인 `mina daemon` 을 `Ctrl-C` 를 통해 종료한 뒤, 다음을 계속 읽으시기 바랍니다.

### Ubuntu 18.04 / Debian 9

등록한 개인키가 `~/keys/my-wallet` 에 위치하는지 확인하시기 바랍니다.

`~/.mina-env` 파일을 생성하고, 아래의 내용을 추가하시기 바랍니다.

```
CODA_PRIVKEY_PASS="private key password"
EXTRA_FLAGS=" --file-log-level Debug"
```

나중에 필요에 따라 `EXTRA_FLAGS` 에 추가 플래그들을 추가할 수 있습니다.

미나는 `~/peers.txt` 라는 파일에서 피어를 찾을 것이므로, 다음 명령을 실행하여 생성합니다.

```
curl https://storage.googleapis.com/mina-seed-lists/mainnet_seeds.txt > ~/peers.txt
```

그런 다음, 아래의 명령을 실행하여 미나 노드 인스턴스를 시작하고, 네트워크에 연결합니다.

```
systemctl --user daemon-reload
systemctl --user start mina
systemctl --user enable mina
sudo loginctl enable-linger
```

이 명령을 사용하면 로그아웃 후에도 노드가 계속 실행되고, 시스템이 재부팅될때 자동으로 다시 시작됩니다.

기본적으로, 노드는 8302 외부 포트를 사용하여 네트워크에 연결합니다. 이것은 `-external-port` 플래그를 사용하여 변경할 수 있으며, EXTRA_FLAGS 에 추가하기만 하면 됩니다.

백그라운드에서 실행되고 자동으로 다시 시작되는 미나 프로세스를 살펴볼수 있습니다.

아래의 명령으로 미나가 시작하는데 문제가 있는지 알아볼 수 있습니다.

```
systemctl --user status mina
```

미나를 정상적으로 중지하고, 서비스가 자동으로 재시작 되는것을 중지할 수 있습니다.

```
systemctl --user stop mina
```

수동으로 재시작 할 수도 있습니다.

```
systemctl --user restart mina
```

로그를 볼 수도 있습니다

```
journalctl --user -u mina -n 1000 -f
```

경우에 따라서는, 로그를 보려면 아래의 명령어를 실행해야 합니다.

```
journalctl --user-unit mina -n 1000 -f
```

아래의 명령어는 마지막 1000줄을 보여주고 새로 생성되는 로그를 볼 수 있습니다.

### Docker

Docker 를 사용하여 데몬을 실행할때, 먼저 개인키에 올바른 권한이 설정되어 있는지 확인하시기 바랍니다.

```
cd ~
chmod 700 ~/keys
chmod 600 ~/keys/my-wallet
mkdir ~/.mina-config
```

이제, 키와 ~/.mina-config 가 마운트된 이미지를 실행하면 됩니다.

```
docker run --name mina -d \
-p 8302:8302 \
--restart=always \
--mount "type=bind,source=`pwd`/keys,dst=/keys,readonly" \
--mount "type=bind,source=`pwd`/.mina-config,dst=/root/.mina-config" \
-e CODA_PRIVKEY_PASS="YOUR PASSWORD HERE" \
minaprotocol/mina-daemon-baked:1.1.5-a42bdee \
daemon \
--block-producer-key /keys/my-wallet \
--insecure-rest-server \
--file-log-level Debug \
--log-level Info \
--peer-list-url https://storage.googleapis.com/mina-seed-lists/mainnet_seeds.txt
```

`docker logs -f mina` 를 실행하여 로그를 추적하고, 충돌이 발생하면 `docker logs mina > mina-log.txt` 를 통해 로그를 파일에 저장하여 디스코드 #mentor-nodes 채널에 게시하거나, 파일을 Github 이슈에 첨부하여 해당 링크를 디스코드에 공유하시기 바랍니다.

`docker exec -it mina mina client status` 를 실행하여 네트워크 연결을 모니터링 할수 있습니다. 최소 10개의 피어를 빠르게 찾고, 블록 높이와 최대 블록 높이가 올라가는걸 확인해야 합니다.

<Alert>

Docker 컨테이너를 실행할때 `[Warn] Shutdown before Coda instance was created, not saving a visualization` 문제가 발생한다면, [Docker 컨테이너가 사용할 수 있는 자원을 늘려야 합니다](https://docs.docker.com/config/containers/resource_constraints/).

</Alert>

## 연결 확인하기

이제 노드를 시작하고 미나 데몬을 실행 중이므로, 다른 쉘을 열어서 아래의 명령어를 실행해보시기 바랍니다

    mina client status

<Alert>

처음 시작할때 `mina client status` 가 데몬에 접속하기까지 최대 1분이 소요될 수 있습니다. 만약 `Error: daemon not running. See mina daemon` 가 보인다면, 잠깐 기다린 뒤 다시 시도해보시기 바랍니다.

혹시, <DocLink copy="GetSandbox Nodeing" url="/developers/sandbox-node" /> 를 사용하는 경우 명령에 대한 통신 방식의 문제로 인해 컨테이너 내부에서 `mina client status` 명령을 실행해야 합니다:

`docker exec -it mina bash`

</Alert>

대부분 아래의 필드가 포함된 결과가 표시될 것입니다.

    ...
    Peers:                                         Total: 4 (...)
    ...
    Sync Status:                                   Bootstrap

`Sync Status: Bootstrap` 이 보인다면, 노드가 부트스트랩 중이며 나머지 네트워크와 동기화해야 함을 의미합니다. 이 단계에서 노드가 필요한 데이터를 가져오는데 시간이 걸릴 수 있으므로 기다리셔야 합니다.

잠시 후 노드는 더 많은 피어에 연결되고 그 이후 `Sync Status: Catchup` 변경되어야 합니다. 이 상태에서는 가장 최근의 블록을 수집하고 가장 높은 블록을 캐치합니다.

동기화 상태가 `Synced` 에 도달하고 노드가 1개 이상의 피어에 연결되면, 네트워크에 성공적으로 연결된 것입니다. 동기화가 완료되면 다음과 같은 데몬 로그도 볼 수 있습니다. `[Info] Mina daemon is now synced`

`Bootstrap` 상태가 한 시간 이상 지속되면 포트 설정에 문제가 있을 수도 있습니다.

## 계속 진행해보기

이제, 노드가 완전히 동기화 되었으므로, 트랜젝션을 보내거나 스테이킹, 위임하기 등과 같은 고급 기능에 대해 배울 수 있습니다. 혹시, 더 많은 토큰이 필요하시면 재단 위임 프로그램을 확인해보시기 바랍니다.

<span id="disclaimer">

\*_테스트넷 포인트는 테스트넷에 대한 기여를 추적하기 위한 목적으로만 설계되었으며 테스트넷 포인트는 현금이나 기타 금전적 가치가 없습니다. 테스트넷 포인트는 양도할 수 없으며 암호화폐 또는 디지털 자산으로 교환이 불가능합니다. 당사는 언제든지 테스트넷 포인트를 수정하거나 없앨 수 있습니다._

</span>
